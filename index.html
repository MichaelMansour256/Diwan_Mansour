<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diwan Mansour for Books</title>
    <meta name="description" content="ديوان منصور للكتب" />
    <meta name="theme-color" content="#92400E" />
    <!-- Open Graph for rich link previews -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Diwan Mansour for Books" />
    <meta property="og:description" content="مكتبة إلكترونية لعرض وبيع الكتب" />
    <!-- IMPORTANT: replace with your deployed absolute URL to the logo image -->
    <meta property="og:image" content="https://diwan-mansour.vercel.app/logo.png" />
    <meta property="og:url" content="https://diwan-mansour.vercel.app" />
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Diwan Mansour for Books" />
    <meta name="twitter:description" content="مكتبة إلكترونية لعرض وبيع الكتب" />
    <meta name="twitter:image" content="https://diwan-mansour.vercel.app/logo.png" />
    <link rel="icon" type="image/png" href="./logo.png" />

    <!-- Tailwind CDN (play) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: { extend: {} },
      };
    </script>
    <style>
      .notice { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
      .errorBox { padding:12px; color:#991b1b; background:#fef2f2; border:1px solid #fecaca; white-space:pre-wrap; }
      .infoBox { padding:12px; color:#064e3b; background:#ecfdf5; border:1px solid #a7f3d0; }
    </style>
  </head>
  <body class="min-h-screen">
    <div id="root"></div>
    <div id="notice" class="notice"></div>

    <!-- React + ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for in-browser JSX transform (dev only) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase (compat builds for simplicity in this demo) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script>
      // TODO: replace with your Firebase config from the Firebase Console
      // Project settings -> Your apps -> SDK setup and configuration
      window.DM_FIREBASE_CONFIG = {
        apiKey: "AIzaSyDc1o259JWPXOWyByKlD7uCu09K8ebB68U",
        authDomain: "diwanmansour-f8d3a.firebaseapp.com",
        projectId: "diwanmansour-f8d3a",
        storageBucket: "diwanmansour-f8d3a.firebasestorage.app",
        messagingSenderId: "178551104011",
        appId: "1:178551104011:web:71894ea60e87231d209d0e"

      };
      (function initFirebase(){
        try {
          if (window.firebase && !window.firebaseApp && window.DM_FIREBASE_CONFIG && window.DM_FIREBASE_CONFIG.apiKey !== 'YOUR_API_KEY') {
            window.firebaseApp = firebase.initializeApp(window.DM_FIREBASE_CONFIG);
            window.firebaseAuth = firebase.auth();
            window.firebaseDb = firebase.firestore();
            window.firebaseStorage = firebase.storage();
            window.firebaseAuth.setPersistence('local').catch(()=>{});
          }
        } catch (e) { console.error('Firebase init error', e); }
      })();
    </script>

    <!-- App: load the JSX file content inline for demo use -->
    <script type="text/babel" data-type="module" data-presets="env,react">
      async function loadApp() {
        const notice = document.getElementById('notice');
        function showInfo(html) { notice.innerHTML = '<div class="infoBox">' + html + '</div>'; }
        function showError(html) { notice.innerHTML = '<div class="errorBox">' + html + '</div>'; }
        try {
          if (location.protocol === 'file:') {
            showInfo('For security reasons, some browsers block loading local files. Please run a local server:<br/><code>python -m http.server 5173</code> or <code>npx serve -s . --listen 5173</code> and open <code>http://localhost:5173/index.html</code>.');
          }

          const res = await fetch('./DiwanMansourBooks.jsx', { cache: 'no-store' });
          if (!res.ok) {
            throw new Error('HTTP ' + res.status + ' ' + res.statusText + ' fetching DiwanMansourBooks.jsx');
          }
          const code = await res.text();

          // Strip the React import line and default export for in-browser eval
          const stripped = code
            .replace(/^import\s+[^\n]*react[^\n]*\n/i, '')
            .replace(/export\s+default\s+/i, '');

          // Ensure App is exposed globally regardless of eval scoping
          const expose = '\n;try{window.App = App;}catch(e){}\n';
          const shim = 'const { useEffect, useMemo, useState } = React;\n';
          let transformed;
          try {
            transformed = Babel.transform(shim + stripped + expose, { presets: ['env', 'react'] }).code;
          } catch (transformErr) {
            showError('Babel transform error.\n' + transformErr.message + '\n\nTip: Ensure the file starts with an import of React and uses `export default function App()`');
            console.error(transformErr);
            return;
          }

          try {
            // eslint-disable-next-line no-eval
            eval(transformed);
          } catch (evalErr) {
            showError('Runtime eval error.\n' + (evalErr.stack || evalErr.message));
            console.error(evalErr);
            return;
          }

          if (typeof window.App !== 'function') {
            showError('App was not defined after loading the file.\nMake sure it declares `export default function App()` and no other top-level `export` remains.');
            return;
          }

          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(React.createElement(window.App));
        } catch (err) {
          console.error(err);
          showError('Failed to load demo.\n' + (err.stack || err.message));
        }
      }
      loadApp();
    </script>
  </body>
</html>
